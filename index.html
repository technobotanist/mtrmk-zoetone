<!DOCTYPE html>
<html>
  <head>
    <title>Audio Visualizer</title>
    <meta name="description" content="Audio Visualizer">
<!--   This is a series of components and plugins used -->
<!-- AFrame webXR Library   -->
<script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>

<!--Buttons and other event system uses event-set component and proxy events -->
<script src="https://unpkg.com/aframe-event-set-component@^4.0.0/dist/aframe-event-set-component.min.js"></script> 
    
<!--   The layout of buttons utilizes layout component and text positioning uses look-at-->
<script src="https://unpkg.com/aframe-layout-component@4.3.1/dist/aframe-layout-component.min.js"></script> 
<script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script> 

<!-- troika text component allows branded fonts -->
<script src="https://unpkg.com/aframe-troika-text/dist/aframe-troika-text.min.js"></script>
    
<!--     Local scripts -->
    <script src="./playtracks.js"></script>
    <script src="./aframe-audioanalyser-component.js"></script> 
    <script src="./audio-level-scale-component.js"></script>
    <script src="./audio-ring-on-beat.js"></script>
    <script src="./audio-ring-on-beat2.js"></script>
    <script src="./frequency-spectrum-component.js"></script>
    <script src="./spectrogram-component.js"></script>
    <script src="./proxy-event.js"></script>
    <script src="./info-message.js"></script>
    <script src="./audio-light-on-beat.js"></script>
    <script src="shader-grid-glitch.js"></script>
    <script src="shader-hologram.js"></script>
    
</head>
<body>

  <div id="channel-controls" style="position: absolute; z-index: 10;  color: #fff; padding: 1em; border-radius: 8px; top: 1em; left: 1em; min-width: 18em;">
    <div style="display: flex; align-items: center; justify-content: space-between;">
      <label style="margin-bottom: 0;">Number of Channels:
        <input type="number" id="channelCount" min="0" max="6" value="6" style="width: 3em;">
      </label>
      <div>
        <button id="playPauseBtn" style="margin-left: 0.5em; font-size: 1em;">▶️</button>
        <button id="minimizeBtn" style="margin-left: 0.5em; font-size: 1em;">_</button>
      </div>
    </div>
    <div id="trackInputs" style="margin-top: 0.5em;"></div>
    <div id="modelControls" style="margin-top: 1em; padding: 0.5em; background: rgba(30,30,30,0.7); border-radius: 6px;">
      <label style="display: block; margin-bottom: 0.5em;">3D Model URL:
        <input type="url" id="keyModelUrl" placeholder="Paste .glb/.gltf URL or leave for default" style="width: 20em;">
      </label>
      <label style="display: block;">3D Model Scale:
        <input type="range" id="keyModelScale" min="0.01" max="10" step="0.01" value="0.5" style="width: 10em;">
        <span id="keyModelScaleValue">0.5</span>
      </label>
      <label style="display: block; margin-top: 0.5em;">Or upload a 3D model:
        <input type="file" id="keyModelFile" accept=".glb,.gltf,model/gltf-binary,model/gltf+json">
      </label>
      <div id="modelTransformControls" style="margin-top: 0.5em; background: rgba(40,40,40,0.5); padding: 0.5em; border-radius: 6px;">
        <span style="font-weight: bold;">Model Rotation</span>
        <label style="display: block;">X: <input type="range" id="modelRotateX" min="0" max="360" step="0.1" value="49.8" style="width: 8em;"> <span id="modelRotateXValue">49.8</span>°</label>
        <label style="display: block;">Y: <input type="range" id="modelRotateY" min="0" max="360" step="0.1" value="125.5" style="width: 8em;"> <span id="modelRotateYValue">125.5</span>°</label>
        <label style="display: block;">Z: <input type="range" id="modelRotateZ" min="0" max="360" step="0.1" value="128" style="width: 8em;"> <span id="modelRotateZValue">128</span>°</label>
      </div>
      <div id="orbitControls" style="margin-top: 1em; background: rgba(40,40,40,0.5); padding: 0.5em; border-radius: 6px;">
        <span style="font-weight: bold;">Camera Orbit</span>
        <label style="display: block; margin-top: 0.5em;">
          <input type="checkbox" id="orbitCameraCheckbox"> Enable Random Camera Orbit
        </label>
      </div>
    </div>
  </div>

  <a-scene info-message="htmlSrc: #messageText">
    <a-assets id="audio-assets">
      <!-- Audio elements will be injected here by JS -->
    </a-assets>
  
    <script>
    // --- Dynamic Channel UI and Audio Management ---
    const defaultTracks = [
      "https://raw.githubusercontent.com/technobotanist/mtrmk-zoetone/main/Zoetone-Demo-Assets/b0549471-c315-468a-a311-ae093a717da9_LDlane1_kastelheimer.mp3",
      "https://raw.githubusercontent.com/technobotanist/mtrmk-zoetone/main/Zoetone-Demo-Assets/b0549471-c315-468a-a311-ae093a717da9_LDlane2_drums.mp3",
      "https://raw.githubusercontent.com/technobotanist/mtrmk-zoetone/main/Zoetone-Demo-Assets/b0549471-c315-468a-a311-ae093a717da9_LDlane3leadsynth.mp3",
      "https://raw.githubusercontent.com/technobotanist/mtrmk-zoetone/main/Zoetone-Demo-Assets/b0549471-c315-468a-a311-ae093a717da9_LDlane4backingOrgan.mp3",
      "https://raw.githubusercontent.com/technobotanist/mtrmk-zoetone/main/Zoetone-Demo-Assets/b0549471-c315-468a-a311-ae093a717da9_LDlane5wailsynth.mp3",
      "https://raw.githubusercontent.com/technobotanist/mtrmk-zoetone/main/Zoetone-Demo-Assets/b0549471-c315-468a-a311-ae093a717da9_LDlane6midgroundsynth.mp3"
    ];

    // --- Key Model Dynamic Controls ---
    const defaultKeyModelUrl = "https://raw.githubusercontent.com/technobotanist/mtrmk-zoetone/main/Zoetone-Demo-Assets/b0549471-c315-468a-a311-ae093a717da9_MTRMagicKeyTrueOrigin.gltf";
    window.addEventListener('DOMContentLoaded', () => {
      // Key Model Controls
      const keyModelUrlInput = document.getElementById('keyModelUrl');
      const keyModelScaleInput = document.getElementById('keyModelScale');
      const keyModelScaleValue = document.getElementById('keyModelScaleValue');
      const keyModelFileInput = document.getElementById('keyModelFile');
      const userKeyAsset = document.getElementById('userkeymodel');
      const playbuttonkey = document.getElementById('playbuttonkey');
      let currentModelUrl = defaultKeyModelUrl;
      let lastFileUrl = null;
      // Set default values
      keyModelUrlInput.value = defaultKeyModelUrl;
      keyModelScaleInput.value = 0.5;
      keyModelScaleValue.textContent = '0.5';
      // Set default model rotation values
      const modelRotateX = document.getElementById('modelRotateX');
      const modelRotateY = document.getElementById('modelRotateY');
      const modelRotateZ = document.getElementById('modelRotateZ');
      const modelRotateXValue = document.getElementById('modelRotateXValue');
      const modelRotateYValue = document.getElementById('modelRotateYValue');
      const modelRotateZValue = document.getElementById('modelRotateZValue');
      modelRotateX.value = 49.8;
      modelRotateY.value = 125.5;
      modelRotateZ.value = 128;
      modelRotateXValue.textContent = '49.8';
      modelRotateYValue.textContent = '125.5';
      modelRotateZValue.textContent = '128';
      function updateKeyModel(url, isFile) {
        if (isFile && lastFileUrl) {
          URL.revokeObjectURL(lastFileUrl);
        }
        if (typeof url !== 'string' || !url.trim()) {
          url = defaultKeyModelUrl;
        }
        currentModelUrl = url;
        if (url && typeof url === 'string' && url.trim()) {
          userKeyAsset.setAttribute('src', url);
          playbuttonkey.removeAttribute('gltf-model');
          // Wait for asset to load before setting gltf-model
          const onAssetLoaded = () => {
            playbuttonkey.setAttribute('gltf-model', '#userkeymodel');
            userKeyAsset.removeEventListener('loaded', onAssetLoaded);
          };
          userKeyAsset.addEventListener('loaded', onAssetLoaded);
          // Fallback: if asset fails to load in 2s, revert to default
          setTimeout(() => {
            if (!userKeyAsset.hasLoaded) {
              userKeyAsset.setAttribute('src', defaultKeyModelUrl);
              // Wait for default to load, then set gltf-model
              const onDefaultLoaded = () => {
                playbuttonkey.setAttribute('gltf-model', '#userkeymodel');
                userKeyAsset.removeEventListener('loaded', onDefaultLoaded);
              };
              userKeyAsset.addEventListener('loaded', onDefaultLoaded);
            }
          }, 2000);
        }
        if (isFile) lastFileUrl = url;
      }
      // On initial load, wait for asset to load before setting gltf-model
      if (userKeyAsset && playbuttonkey) {
        playbuttonkey.removeAttribute('gltf-model');
        const onInitialAssetLoaded = () => {
          playbuttonkey.setAttribute('gltf-model', '#userkeymodel');
          userKeyAsset.removeEventListener('loaded', onInitialAssetLoaded);
        };
        userKeyAsset.addEventListener('loaded', onInitialAssetLoaded);
      }
      function updateKeyScale() {
        const userScale = parseFloat(keyModelScaleInput.value) || 0.5;
        playbuttonkey.setAttribute('scale', `${userScale} ${userScale} ${userScale}`);
        keyModelScaleValue.textContent = userScale.toFixed(2);
      }
      function updateModelRotation() {
        const x = parseFloat(modelRotateX.value) || 0;
        const y = parseFloat(modelRotateY.value) || 0;
        const z = parseFloat(modelRotateZ.value) || 0;
        modelRotateXValue.textContent = x;
        modelRotateYValue.textContent = y;
        modelRotateZValue.textContent = z;
        playbuttonkey.setAttribute('rotation', `${x} ${y} ${z}`);
      }
      modelRotateX.addEventListener('input', updateModelRotation);
      modelRotateY.addEventListener('input', updateModelRotation);
      modelRotateZ.addEventListener('input', updateModelRotation);
      keyModelUrlInput.addEventListener('change', () => {
        const url = keyModelUrlInput.value.trim();
        if (url) {
          updateKeyModel(url, false);
        } else {
          updateKeyModel(defaultKeyModelUrl, false);
          keyModelUrlInput.value = defaultKeyModelUrl;
        }
      });
      keyModelScaleInput.addEventListener('input', updateKeyScale);
      keyModelFileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          const url = URL.createObjectURL(file);
          updateKeyModel(url, true);
        }
      });
      // Initialize
      updateKeyModel(defaultKeyModelUrl, false);
      updateKeyScale();
      updateModelRotation();
      // --- Camera Orbit ---
      // Only move the rig, let look-at handle orientation
      const orbitCheckbox = document.getElementById('orbitCameraCheckbox');
      let orbitRequest = null;
      let orbitAngle = 0;
      let orbitSpeed = 0.005 + Math.random() * 0.01;
      let orbitRadius = 16 + Math.random() * 6;
      let orbitHeight = 2 + Math.random() * 2;
      const rig = document.getElementById('rig');
      const zoetonecomplex = document.getElementById('zoetonecomplex');
      const defaultRigPos = {x: 0, y: 0, z: 0};
      const defaultZoetoneRot = {x: 0, y: 0, z: 0};
      function animateOrbit() {
        orbitAngle += orbitSpeed;
        const x = Math.cos(orbitAngle) * orbitRadius;
        const z = Math.sin(orbitAngle) * orbitRadius;
        if (rig) rig.setAttribute('position', `${x} ${orbitHeight} ${z}`);
        if (orbitRequest) orbitRequest = requestAnimationFrame(animateOrbit);
      }
      function startOrbit() {
        if (orbitRequest) return;
        orbitAngle = Math.random() * Math.PI * 2;
        orbitSpeed = 0.005 + Math.random() * 0.01;
        orbitRadius = 16 + Math.random() * 6;
        orbitHeight = 2 + Math.random() * 2;
        // Randomize zoetonecomplex Y rotation for dynamic view
        if (zoetonecomplex) {
          const randomY = Math.floor(Math.random() * 360);
          zoetonecomplex.setAttribute('rotation', `0 ${randomY} 0`);
        }
        orbitRequest = requestAnimationFrame(animateOrbit);
      }
      function stopOrbit() {
        if (orbitRequest) {
          cancelAnimationFrame(orbitRequest);
          orbitRequest = null;
        }
        if (rig) rig.setAttribute('position', `${defaultRigPos.x} ${defaultRigPos.y} ${defaultRigPos.z}`);
        if (zoetonecomplex) zoetonecomplex.setAttribute('rotation', `${defaultZoetoneRot.x} ${defaultZoetoneRot.y} ${defaultZoetoneRot.z}`);
      }
      if (orbitCheckbox) {
        orbitCheckbox.addEventListener('change', () => {
          if (orbitCheckbox.checked) {
            startOrbit();
          } else {
            stopOrbit();
          }
        });
      }
      window.addEventListener('beforeunload', stopOrbit);
    });

    // Helper: get current track URLs from audio elements (if present)
    function getCurrentTrackUrls() {
      const urls = [];
      for (let i = 0; i < 6; i++) {
        const el = document.getElementById(`lane${i+1}`);
        urls.push(el ? el.src : defaultTracks[i]);
      }
      return urls;
    }

    // --- AudioContext safeguard ---
    let audioContextResumed = false;
    function resumeAllAudioContexts() {
      // Resume all AudioContexts on the page (A-Frame, Web Audio, etc.)
      if (audioContextResumed) return;
      audioContextResumed = true;
      if (window.AFRAME && AFRAME.scenes && AFRAME.scenes.length) {
        AFRAME.scenes.forEach(scene => {
          if (scene.audioListener && scene.audioListener.context && scene.audioListener.context.state === 'suspended') {
            scene.audioListener.context.resume();
          }
        });
      }
      // Resume all audio elements
      for (let i = 0; i < 6; i++) {
        const el = document.getElementById(`lane${i+1}`);
        if (el && el.paused) {
          el.play().catch(()=>{});
        }
      }
    }
    // Listen for first user gesture
    window.addEventListener('pointerdown', resumeAllAudioContexts, { once: true });
    window.addEventListener('keydown', resumeAllAudioContexts, { once: true });

    const channelCountInput = document.getElementById('channelCount');
    const trackInputsDiv = document.getElementById('trackInputs');
    const audioAssets = document.getElementById('audio-assets');
    const channelControls = document.getElementById('channel-controls');
    const minimizeBtn = document.getElementById('minimizeBtn');
    const playPauseBtn = document.getElementById('playPauseBtn');

    let minimized = false;
    let playing = false;

    // --- Audio element reuse ---
    function updateChannels() {
      const count = parseInt(channelCountInput.value, 10);
      // Get current URLs before removing
      const prevUrls = getCurrentTrackUrls();

      // Reuse or create audio elements as needed
      let existingAudios = [];
      for (let i = 0; i < 6; i++) {
        const el = document.getElementById(`lane${i+1}`);
        if (el) existingAudios.push(el);
      }

      // Remove extra audio elements if reducing channel count
      for (let i = count; i < existingAudios.length; i++) {
        existingAudios[i].remove();
      }

      // Add or update audio elements up to count
      for (let i = 0; i < count; i++) {
        let audio = document.getElementById(`lane${i+1}`);
        if (!audio) {
          audio = document.createElement('audio');
          audio.id = `lane${i+1}`;
          audio.className = `music${i+1}`;
          audio.setAttribute('crossorigin', 'anonymous');
          audio.setAttribute('preload', 'auto');
          audioAssets.appendChild(audio);
        }
        audio.src = prevUrls[i] || defaultTracks[i] || '';
        if (!playing) audio.pause();
      }

      // Update the UI inputs
      trackInputsDiv.innerHTML = '';
      // Store last object URLs to revoke on new upload
      if (!window._audioFileObjectUrls) window._audioFileObjectUrls = Array(6).fill(null);
      for (let i = 0; i < count; i++) {
        const audio = document.getElementById(`lane${i+1}`);
        const label = document.createElement('label');
        label.style.display = 'block';
        label.textContent = `Channel ${i+1}: `;
        // URL input
        const urlInput = document.createElement('input');
        urlInput.type = 'url';
        urlInput.placeholder = 'Paste audio URL or leave for default';
        urlInput.value = audio.src;
        urlInput.style.width = '20em';
        urlInput.addEventListener('change', e => {
          // Revoke previous object URL if present
          if (window._audioFileObjectUrls[i]) {
            URL.revokeObjectURL(window._audioFileObjectUrls[i]);
            window._audioFileObjectUrls[i] = null;
          }
          audio.src = e.target.value;
          // Trigger canplay event and re-apply audioanalyser
          audio.addEventListener('canplay', () => {
            const visIds = ['Silver', 'Blue', 'Gold', 'Pink', 'Green', 'White'];
            const ent = document.getElementById(visIds[i]);
            if (ent) {
              ent.setAttribute('audioanalyser', `src: #lane${i+1}; enabled: true`);
            }
          }, { once: true });
        });
        label.appendChild(urlInput);
        // Upload button
        const uploadInput = document.createElement('input');
        uploadInput.type = 'file';
        uploadInput.accept = 'audio/*';
        uploadInput.style.marginLeft = '0.5em';
        uploadInput.title = 'Upload audio file for this channel';
        uploadInput.addEventListener('change', e => {
          const file = e.target.files[0];
          if (file) {
            // Revoke previous object URL if present
            if (window._audioFileObjectUrls[i]) {
              URL.revokeObjectURL(window._audioFileObjectUrls[i]);
            }
            const url = URL.createObjectURL(file);
            audio.src = url;
            window._audioFileObjectUrls[i] = url;
            // Also update the URL input to show [Local File]
            urlInput.value = '';
            // Trigger canplay event and re-apply audioanalyser
            audio.addEventListener('canplay', () => {
              const visIds = ['Silver', 'Blue', 'Gold', 'Pink', 'Green', 'White'];
              const ent = document.getElementById(visIds[i]);
              if (ent) {
                ent.setAttribute('audioanalyser', `src: #lane${i+1}; enabled: true`);
              }
            }, { once: true });
          }
        });
        label.appendChild(uploadInput);
        trackInputsDiv.appendChild(label);
      }

      // Update/mute/hide visualization geometries
      const visIds = [
        'Silver', 'Blue', 'Gold', 'Pink', 'Green', 'White'
      ];
      visIds.forEach((id, idx) => {
        const ent = document.getElementById(id);
        if (ent) {
          if (idx < count) {
            ent.setAttribute('visible', 'true');
            ent.setAttribute('audioanalyser', `src: #lane${idx+1}; enabled: true`);
          } else {
            ent.setAttribute('visible', 'false');
            ent.setAttribute('audioanalyser', 'enabled: false; src:');
          }
        }
      });

      // Patch for playtracks.js: set window.audio1..audio6 to the new audio elements
      for (let i = 0; i < 6; i++) {
        const el = document.getElementById(`lane${i+1}`);
        window[`audio${i+1}`] = el || null;
      }
      // --- Dispatch custom event for playtracks.js integration ---
      // Notify that audio elements and globals are ready, with details
      const event = new CustomEvent('audioElementsReady', {
        detail: {
          count,
          audios: Array.from({length: 6}, (_, i) => window[`audio${i+1}`])
        }
      });
      window.dispatchEvent(event);
    }

    function setMinimized(min) {
      minimized = min;
      const modelControlsDiv = document.getElementById('modelControls');
      if (minimized) {
        trackInputsDiv.style.display = 'none';
        channelCountInput.parentElement.style.display = 'none';
        if (modelControlsDiv) modelControlsDiv.style.display = 'none';
        minimizeBtn.textContent = '▢';
      } else {
        trackInputsDiv.style.display = '';
        channelCountInput.parentElement.style.display = '';
        if (modelControlsDiv) modelControlsDiv.style.display = '';
        minimizeBtn.textContent = '_';
      }
    }

    minimizeBtn.addEventListener('click', () => {
      setMinimized(!minimized);
    });

    function setPlayState(play) {
      playing = play;
      const audios = audioAssets.querySelectorAll('audio');
      audios.forEach(audio => {
        if (play) {
          audio.play().catch(()=>{});
        } else {
          audio.pause();
        }
      });
      playPauseBtn.textContent = play ? '⏸️' : '▶️';
    }

    playPauseBtn.addEventListener('click', () => {
      setPlayState(!playing);
    });

    channelCountInput.addEventListener('input', updateChannels);
    window.addEventListener('DOMContentLoaded', () => {
      updateChannels();
      setMinimized(false);
      setPlayState(false);
    });
    </script>

<!--Brand 3 Models -->        
<a-asset-item id="magickey" crossorigin="anonymous" src="https://raw.githubusercontent.com/technobotanist/mtrmk-zoetone/main/Zoetone-Demo-Assets/b0549471-c315-468a-a311-ae093a717da9_MTRMagicKeyTrueOrigin.gltf" preload="auto"></a-asset-item>
<a-asset-item id="userkeymodel" crossorigin="anonymous" preload="auto" src="https://raw.githubusercontent.com/technobotanist/mtrmk-zoetone/main/Zoetone-Demo-Assets/b0549471-c315-468a-a311-ae093a717da9_MTRMagicKeyTrueOrigin.gltf"></a-asset-item>
<a-asset-item id="whitemagickeytext" crossorigin="anonymous" src="https://raw.githubusercontent.com/technobotanist/mtrmk-zoetone/main/Zoetone-Demo-Assets/b0549471-c315-468a-a311-ae093a717da9_WhiteMTRMagicKeyText.glb" preload="auto"></a-asset-item>
<a-asset-item id="silvermagickeytext" crossorigin="anonymous" src="https://raw.githubusercontent.com/technobotanist/mtrmk-zoetone/main/Zoetone-Demo-Assets/b0549471-c315-468a-a311-ae093a717da9_SilverMTRMagicKeyText.glb" preload="auto"></a-asset-item>
<a-asset-item id="goldmagickeytext" crossorigin="anonymous" src="https://raw.githubusercontent.com/technobotanist/mtrmk-zoetone/main/Zoetone-Demo-Assets/b0549471-c315-468a-a311-ae093a717da9_GoldMTRMagicKeyText.glb" preload="auto"></a-asset-item>
<a-asset-item id="pinkmagickeytext" crossorigin="anonymous" src="https://raw.githubusercontent.com/technobotanist/mtrmk-zoetone/main/Zoetone-Demo-Assets/b0549471-c315-468a-a311-ae093a717da9_PinkMTRMagicKeyText.glb" preload="auto"></a-asset-item>
<a-asset-item id="bluemagickeytext" crossorigin="anonymous" src="https://raw.githubusercontent.com/technobotanist/mtrmk-zoetone/main/Zoetone-Demo-Assets/b0549471-c315-468a-a311-ae093a717da9_BlueMTRMagicKeyText.glb" preload="auto"></a-asset-item>
<a-asset-item id="greenmagickeytext" crossorigin="anonymous" src="https://raw.githubusercontent.com/technobotanist/mtrmk-zoetone/main/Zoetone-Demo-Assets/b0549471-c315-468a-a311-ae093a717da9_GreenMTRMagicKeyText.glb" preload="auto"></a-asset-item>

<!-- Text for bottom right corner pop up -->
<a-asset-item id="messageText" src="message.html"></a-asset-item>

<!--TR Magic Key Brand Fonts -->
<a-asset-item id="magickeytitlingfont" crossorigin="anonymous" src="https://raw.githubusercontent.com/technobotanist/mtrmk-zoetone/main/Zoetone-Demo-Assets/b0549471-c315-468a-ae093a717da9_MagicKeyTitlingFont.ttf"></a-asset-item>

 <a-mixin   
          id="splashaway"
                    event-set__splashaway1= "
                _event : click;
                _target : #startprompt;
                animation.property : position;
                animation.to: 0 106.5 -15         ;"
          ></a-mixin>
        
   <a-mixin   
          id="magickeywhitetextaway"
          event-set__whitetextaway= "
                _event : click;
                _target : #whitemagickey;
                animation.property : visible;
                animation.to: false;"
          ></a-mixin>
           <a-mixin   
          id="magickeysilvertextaway"
          event-set__silvertextaway= "
                _event : click;
                _target : #silvermagickey;
                animation.property : visible;
                animation.to: false;"
          ></a-mixin>
           <a-mixin   
          id="magickeygoldtextaway"
          event-set__goldtextaway= "
                _event : click;
                _target : #goldmagickey;
                animation.property : visible;
                animation.to: false;"
          ></a-mixin>
           <a-mixin   
          id="magickeypinktextaway"
          event-set__pinktextaway= "
                _event : click;
                _target : #pinkmagickey;
                animation.property : visible;
                animation.to: false;"
          ></a-mixin>
           <a-mixin   
          id="magickeybluetextaway"
          event-set__bluetextaway= "
                _event : click;
                _target : #bluemagickey;
                animation.property : visible;
                animation.to: false;"
          ></a-mixin>
           <a-mixin   
          id="magickeygreentextaway"
          event-set__greentextaway= "
                _event : click;
                _target : #greenmagickey;
                animation.property : visible;
                animation.to: false;"
          ></a-mixin>
   

  
      </a-assets>
 
      <a-entity 
                position="-5 0 0"
                light="intensity: 1; type: point; castShadow: true" rotation=""
                light-on-beat="analyserEl: #white"
></a-entity>
      
    
      <a-entity id="rig" position="0 0 0" rotation="0 0 0" >
        <a-entity id="eyes"
          camera="fov: 80"
          look-at="#zoetonecomplex"
          position=""
          rotation=""
          raycaster="objects: .mouse; direction: -24 -3 0;" cursor="rayOrigin: mouse"
          static-body="shape: sphere; sphereRadius: 0.001">
        </a-entity>
      </a-entity>  
      
      <a-entity id="responsivetext">
      <a-entity id="whitemagickey"
          visible="false"
          rotation="" 
          position="0 20 -40"
          gltf-model="#whitemagickeytext" 
          scale="15 15 15"
          light-on-beat="analyserEl: #White"
          light="color: #ffffff; groundColor: #ffffff; intensity: 1; type: point; castShadow: true"
></a-entity>
        <a-entity id="silvermagickey" 
          visible="false"
          rotation="" 
          position="0 20 -40"
          gltf-model="#silvermagickeytext" 
          scale="15 15 15"
          light-on-beat="analyserEl: #Silver"
          light="color: #8c8c8c; groundColor: #8c8c8c; intensity: 1; type: point; castShadow: true"
></a-entity>
        <a-entity id="goldmagickey" 
          visible="false"
          rotation="" 
          position="0 20 -40"
          gltf-model="#goldmagickeytext" 
          scale="15 15 15"
          light-on-beat="analyserEl: #Gold"
          light="color: #f9dea2; groundColor: #f9dea2; intensity: 1; type: point; castShadow: true"
></a-entity>
        <a-entity id="pinkmagickey" 
          visible="false"
          rotation="" 
          position="0 20 -40"
          gltf-model="#pinkmagickeytext" 
          scale="15 15 15"
          light-on-beat="analyserEl: #Pink"
          light="color: #df7592; groundColor: #df7592; intensity: 1; type: point; castShadow: true"
></a-entity>
        <a-entity id="bluemagickey"
          visible="false"
          rotation="" 
          position="0 20 -40"
          gltf-model="#bluemagickeytext" 
          scale="15 15 15"
          light-on-beat="analyserEl: #Blue"
          light="color: #1ebcb8; groundColor: #1ebcb8; intensity: 1; type: point; castShadow: true"
></a-entity>
                <a-entity id="greenmagickey"
          visible="false"
          rotation="" 
          position="0 20 -40"
          gltf-model="#greenmagickeytext" 
          scale="15 15 15"
          light-on-beat="analyserEl: #Green"
          light="color: #48bc1e; groundColor: #48bc1e; intensity: 1; type: point; castShadow: true"
></a-entity>
      
      </a-entity>
      
      
      <a-entity id="zoetonecomplex" 
                animation__pt1="property: rotation;dir: alternate; from: 0 0 0; to: 0 0 90; loop: true; dur: 30000;startEvents: click"
                animation__pt1a="property: rotation;dir: alternate; from: 0 0 90; to: 0 0 -90; loop: true; dur: 60000;delay: 30000;startEvents: click"
                animation__pt2="property: position;dir: alternate; from: 0 0 0; to: 0 0 -30; loop: true; dur: 60000;startEvents: click"
                animation__pt3="property: scale;dir: alternate; from: 1 1 1;to: 8 8 8; loop: true; dur: 6000;startEvents: click">
<a-entity 
          id="startprompt"
          playtracks="" 
          mixin="splashaway"
          troika-text="value:
MTR Magic Key                  
   
  
                       
                       Raleigh, NC; 
                       align: center; 
                       color: #f9dea2; 
                       font: #magickeytitlingfont; 
                       fontSize: 3; fillOpacity:  0.5;  
                       outlineBlur:  0.34;  outlineColor:  #8c8c8c;  outlineOpacity:  0.64;  outlineWidth:  0.02;  
                       strokeColor:  #f9dea2;  strokeOpacity:  4.01;  strokeWidth:  0.05"
          position="0 3.5 -15"
          ></a-entity>
      
      <a-entity id="playbuttonkey" 
                rotation="49.8 125.5 128" 
                position="-2.25 1 -16"
                gltf-model="#userkeymodel"
                scale="0.5 0.5 0.5"
                mixin="splashaway"
                playtracks=""
                class="mouse"
    ></a-entity>
        

      
      
   <a-sky id="sky" material="color: #2b2622" geometry="radius: 1000"></a-sky>

      <a-entity id="zoetonehome"
            scale="1 1 1" position="-1 0 -15" rotation="0 0 0"
            class="mouse">
            <a-entity 
                    id="Silver"
                    position="-3 0 0" 
                    geometry="primitive: sphere"
                      material="color:  #8c8c8c;  metalness:  0.5; emissive:  #8c8c8c;  emissiveIntensity:  0.6; roughness:  0.75; wireframe:  true"
                     class="mouse"
                      audioanalyser="src: #lane1; beatDetectionDecay: 0.99,
    beatDetectionMinVolume: 15; enableBeatDetection: true"
                    audio-level-scale="positionScale: 1 20 1"
                    mixin="magickeywhitetextaway magickeygoldtextaway magickeypinktextaway magickeybluetextaway magickeygreentextaway splashaway"
               event-set__textcallsilver= "
                _event : click;
                _target : #silvermagickey;
                animation.property : visible;
                animation.to: true;"
           ></a-entity>
            <a-entity 
                    id="Blue" 
                    position="3 0 0" 
                    geometry="primitive: sphere"
                      material="color:  #1ebcb8;  metalness:  0.5; emissive:  #1ebcb8;  emissiveIntensity:  0.6; roughness:  0.75; wireframe:  true"
                    class="mouse"
                    audioanalyser="src: #lane2; beatDetectionDecay: 0.99,
    beatDetectionMinVolume: 15; enableBeatDetection: true"
                    audio-level-scale="positionScale: 1 20 1"
                    mixin="magickeywhitetextaway magickeysilvertextaway magickeygoldtextaway magickeypinktextaway magickeygreentextaway splashaway"
                    ring-on-beat="analyserEl: #Blue"
               event-set__textcallblue= "
                _event : click;
                _target : #bluemagickey;
                animation.property : visible;
                animation.to: true;"
 ></a-entity>
            <a-entity 
                      id="Gold" 
                    position="-1.5 0" 
                    geometry="primitive: sphere"
                      material="color:  #f9dea2;  metalness:  0.5; emissive:  #f9dea2;  emissiveIntensity:  0.6; roughness:  0.75; wireframe:  true"
                    class="mouse"
                      audioanalyser="src: #lane3; beatDetectionDecay: 0.90,
    beatDetectionMinVolume: 5; enableBeatDetection: true"
                      ring-on-beat2="analyserEl: #Gold"
                    audio-level-scale="positionScale: 1 40 1"
                    mixin="magickeywhitetextaway magickeysilvertextaway magickeypinktextaway magickeybluetextaway magickeygreentextaway splashaway"
                      event-set__textcallgold= "
                _event : click;
                _target : #goldmagickey;
                animation.property : visible;
                animation.to: true;"
></a-entity>
            <a-entity 
                      id="Pink" 
                      position="1.5 0 0"
                      geometry="primitive: sphere" 
                      material="color:  #df7592;  metalness:  0.5; emissive:  #df7592;  emissiveIntensity:  0.6; roughness:  0.75; wireframe:  true"
                      class="mouse"
                      audioanalyser="src: #lane4; beatDetectionDecay: 0.90,
    beatDetectionMinVolume: 5; enableBeatDetection: true"
                      audio-level-scale="positionScale: 1 40 1"
                      mixin="magickeywhitetextaway magickeysilvertextaway magickeygoldtextaway magickeybluetextaway magickeygreentextaway splashaway"
               event-set__textcallpink= "
                _event : click;
                _target : #pinkmagickey;
                animation.property : visible;
                animation.to: true;"
></a-entity>
            <a-entity id="Green" 
                      position="4.5 0 0" 
                      geometry="primitive: sphere"
                      material="color:  #48bc1e;  metalness:  0.5; emissive:  #48bc1e;  emissiveIntensity:  0.6; roughness:  0.75; wireframe:  true"
                      class="mouse"
                      audioanalyser="src: #lane5; beatDetectionDecay: 0.99,
    beatDetectionMinVolume: 15; enableBeatDetection: true"
                      audio-level-scale="positionScale: 1 20 1"
                    mixin="magickeywhitetextaway magickeysilvertextaway magickeygoldtextaway magickeypinktextaway magickeybluetextaway splashaway"
                                     event-set__textcallgreen= "
                _event : click;
                _target : #greenmagickey;
                animation.property : visible;
                animation.to: true;"
></a-entity>
            <a-entity id="White" 
                      position="-4.5 0 0" 
                      geometry="primitive: sphere" 
                      material="color:  #ffffff;  metalness:  0.5; emissive:  #ffffff;  emissiveIntensity:  0.6; roughness:  0.75; wireframe:  true"
                      class="mouse"
                      audioanalyser="src: #lane6; beatDetectionDecay: 0.99,
    beatDetectionMinVolume: 15; enableBeatDetection: true"
                      ring-on-beat2="analyserEl: #White"
                      audio-level-scale="positionScale: 1 20 1"
                      mixin="magickeysilvertextaway magickeygoldtextaway magickeypinktextaway magickeybluetextaway magickeygreentextaway splashaway"
                      event-set__textcallwhite= "
                _event : click;
                _target : #whitemagickey;
                animation.property : visible;
                animation.to: true;"
></a-entity></a-entity></a-entity>

     
  </a-scene>
  </body>
</html>
